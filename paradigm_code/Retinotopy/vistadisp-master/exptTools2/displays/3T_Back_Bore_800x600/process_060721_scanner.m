function process_060721_scanner;% calibrationload necLCDDisplayGamma060721data = necLCDDisplayGamma;x = data{1}.vRawData.x(:);y = [data{1}.vRawData.y(:) data{2}.vRawData.y(:) data{3}.vRawData.y(:)];y = y./ (ones(size(y,1),1)*max(y));% fit polynomialxint = linspace(0,1,1024)';Npoly=9;for n=1:3,    p{n} = polyfit(x,y(:,n),Npoly);    yint(:,n) = polyval(p{n},xint)/polyval(p{n},1);end;    % invertcmapMax = 1023;gamma = zeros(cmapMax+1,3);precise = (0:0.01:cmapMax)'/cmapMax; for jj = 1:3	tmp = polyval(p{jj},precise)/polyval(p{jj},1);	for ii=0:cmapMax;		[junk placetmp] = min(abs(ii/cmapMax-tmp));		gamma(ii+1,jj) = precise(placetmp);	endendgamma(gamma>1)=1;gamma(gamma<0)=0;% plot gammafigure(1);clf;X = [0:255]'./255;plot(x,y,'o');hold on;plot(x,mean(y,2),'kx','MarkerSize',20);hold on;plot(xint,yint);axis([0 1 0 1]);axis square;% plot inverted gammafigure(2);clf;plot(y,x,'o');hold on;plot(mean(y,2),x,'kx','MarkerSize',20);hold on;plot(xint,gamma);axis([0 1 0 1]);axis square;yint(yint>1)=1;yint(yint<0)=0;gammaTable = round(gamma.*cmapMax);save('gamma.mat','gamma','gammaTable');return