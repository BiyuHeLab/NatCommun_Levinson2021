function  [results,testParams]=findthresh(display, testParams, stimParams);%% [results,testParams]=findthresh(display, testParams, stimParams);%%Author: Claudio San Roman%Purpose: Find the contrast threshold for each location%  %% Global parameters used for getting subject's data.global keycounter global hrmatrixglobal answercatchglobal ncatchhrmatrix   = zeros(1,4);keycounter=0;% Initializing the subject's responses% results = initResults;%results.hrmatrix=[];results.answercatch=[];results.keycounter=[];results.answer1=[];results.positions=[];results.contrast=[];scale=testParams.contrastscale;zscale =size(scale,2);tableIndexAlter = randperm(size(testParams.alternativeVarValues,1));testParams.tableIndexAlter=tableIndexAlter;for n=1:size(testParams.alternativeVarValues,1)positions(n,:)=testParams.alternativeVarValues(tableIndexAlter(n),:);end%Showing fixation point imagex1= round(testParams.fixloc(1)-size(testParams.imgfixpoint, 2)/2);  y1 = round(testParams.fixloc(2)-size(testParams.imgfixpoint, 1)/2);x2 = round(testParams.fixloc(1)+size(testParams.imgfixpoint, 2)/2);y2 = round(testParams.fixloc(2)+size(testParams.imgfixpoint, 1)/2);    screen(display.windowPtr,'PutImage',testParams.imgfixpoint,[y1-1,x1-1,y2-1,x2-1]);	pause(1);	[contrast,retflag]=locstaircase(positions,testParams,stimParams);results.hrmatrix=hrmatrix(2:size(hrmatrix,1),:);results.answercatch=answercatch;results.keycounter=keycounter;results.positions=positions;results.contrast=contrast;