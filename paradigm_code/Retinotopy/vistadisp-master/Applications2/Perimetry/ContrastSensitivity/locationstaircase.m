function [thresholds]=locstaircase(positions,initdirect,testParams,stimParams)%Inputs : input vector to evaluate% Initial Direction :%Scale :%Started contrast :%Output : threshold%Number of changes :scale=testParams.contrastscale;zscale =size(scale,2);% TASK 2 For each alternative value of tabl2 find lowest thresholdcatchcount=0;%For each location Initialize variables for n=1:size(positiontask2,1)	stop(n) =0;	counter(n)=0;	counterdir(n)=initdirect; % 0 for yes ,1 for no,begin at 0 because of task1	thresh(n,:)=zeros(1,4);	outofrange(n)=0;	contrastindex(n)= (testParams.medcontrastindex-1);end% Do for all locations until all STOPs are ones	while(sum(stop)<size(stop,1))	for n=1:size(positions,1)    if(stop(n)==0)	stimParams.position= positions(n,:);	stimParams.contrast=scale(contrastindex(n));   	[trial, data] = Perimtrial(display, stimParams,testParams);    runPriority = 0;    eventNum = 1:size(trial,1);    material = trial{eventNum,2};	t = soundFreqSweep(100, 500, .1);	cleankeybbuff;		sound(t);    showStimulus(display,material.stimulus,runPriority);	catchcount=catchcount+1;	answer=getchar;	keycounter=keycounter+1;	%Stop if required			if (answer1(n)==testParams.keystop) | ( size(hrmatrix,1) > testParams.maxtrials )			  	return		     end		if answer==testParams.keyyes		hrmatrix(size(hrmatrix,1)+1,:)=[stimParams.position stimParams.contrast 1];		disp([stimParams.position stimParams.contrast 1]);			if counterdir(n)==1 					thresh(n,counter(n)+1)=stimParams.contrast;					counter(n)=counter(n)+1;					counterdir(n)=0;					if counter(n)==4						stop(n)=1;					end			end				if contrastindex(n) <= 1			stop(n)=1;			thresholds(n)=scale(1);			outofrange(n)=1;		end		contrastindex(n) = contrastindex(n)-1;	end	if answer==testParams.keyno		hrmatrix(size(hrmatrix,1)+1,:)=[stimParams.position stimParams.contrast 0];		disp([stimParams.position stimParams.contrast 0]);				if counterdir(n)==0 					thresh(n,counter(n)+1)=stimParams.contrast;					%disp(contrast);					counter(n)=counter(n)+1;					counterdir(n)=1;			    	if counter(n)==4					stop(n)=1;				    end            	end		if contrastindex(n) >= zscale			stop(n) =1;			thresholds(n) = scale(zscale);			outofrange(n)=1;		end		contrastindex(n) = contrastindex(n)+1;		endpause(1)catchtrial;end % of inner ifend %of for next below big-whileend % of big-while	%for each point calculate avg of corners !!!for n=1:size(positions,1)if (outofrange(n)==0)thresholds(n)= sum(thresh(n,:))/size(thresh(n,:),2);endend % task2