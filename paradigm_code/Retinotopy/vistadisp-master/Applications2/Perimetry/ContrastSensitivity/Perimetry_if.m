clear all;close all;clear mex;% Dialog Box Interfacebox_title = 'Perimetry';entries = { 'Name', 'Group','Session','Log filename'};z = inputdlg(entries, box_title);name = (z{1});group = (z{2});session = str2num(z{3});filename = z{4};display = loadDisplayParams('screenNumber', 1);display.distance=20;%display = usePredefinedDisplay('screenNumber', 1, 'resolution', '1024x768, 75Hz', 'cmapDepth', 10);display = openScreen(display);% Set your Stimulus poarameters% in screen coordinates, first vertical then horizontalstimParams.position=[300,300];stimParams.duration = 0.3;	% in secondsstimParams.contrast = 1;%stimParams.image = blkball(display.distance,display,9,4);angle = 12;	% Was 8 originallyanglecircle = 8;   % Was 5 originallystimParams.image = whiteball(display.distance,display,angle,anglecircle);%stimParams.image = gabor(display.distance,display,8,5,4);% Set your  Test ParameterstestParams.alternativeVarName = 'position';testParams.subject = name;testParams.group = group;testParams.sessionNum = session;testParams.imgfixpoint=fixpoint(30,15);testParams.fixloc = [300,400];%testParams.alternativeVarValues = [1,1	;200,300;500,500;600,800];%testParams.alternativeVarValues = [200,300;500,500];testParams.alternativeVarValues = perilocations(display,testParams.fixloc(1),testParams.fixloc(2));%testParams.alternativeVarValues=testParams.alternativeVarValues(1:5, :);testParams.expname = {'Perimetry'};testParams.contrastscale =logspace(-2.2,0,5);testParams.medcontrastindex = 5; % to change the starting point of the contrastpressKey2Begin(display);%Savingdatetoday =date;timestart =clock;timestartt=[num2str(timestart(4)),':',num2str(timestart(5)),':',num2str(round(timestart(6)))];[answertricky,keycounter,answer1,ansposition1,contrast2,ansposition2,contrast3,ansposition3,testParams]= ...docaseRAM_if(display, testParams, stimParams);timestop =clock;timesstopt=[num2str(timestop(4)),':',num2str(timestop(5)),':',num2str(round(timestop(6)))];%map=buildmap2(display,stimParams,ansposition2,contrast2,ansposition3,contrast3);%imagesc(map);%clear all;%close all;% Run This to test Perimtrial%[trial, data] = Perimtrial(display, stimParams);%runPriority = 0;%returnHistory=0;%showTimingFlag=0;%eventNum = 1:size(trial,1);%material = trial{eventNum,2};%showStimulus(display,material.stimulus,runPriority);map=zeros(size(answer1));map(answer1=='y')=1;mapvals=mean(map, 1);close allfor m=1:length(mapvals)	text(ansposition1(1, m, 2),600-ansposition1(1, m, 1) ,  num2str(mapvals(m)));	axis([100 650 100 650])	axis offendeval(['save ' filename]);screen('CloseAll');